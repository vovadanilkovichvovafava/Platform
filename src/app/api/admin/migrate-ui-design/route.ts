import { NextResponse } from "next/server"
import { getServerSession } from "next-auth"
import { authOptions } from "@/lib/auth"
import { prisma } from "@/lib/prisma"

// GET - Check existing UI Design trail
export async function GET() {
  try {
    const session = await getServerSession(authOptions)

    if (!session?.user?.id || session.user.role !== "ADMIN") {
      return NextResponse.json({ error: "Только админ" }, { status: 403 })
    }

    const trail = await prisma.trail.findFirst({
      where: {
        OR: [
          { title: { contains: "UI" } },
          { slug: { contains: "ui" } },
        ],
      },
      include: {
        modules: {
          orderBy: { order: "asc" },
          include: { questions: true },
        },
      },
    })

    return NextResponse.json({
      found: !!trail,
      trail: trail ? {
        id: trail.id,
        title: trail.title,
        slug: trail.slug,
        modules: trail.modules.map((m) => ({
          id: m.id,
          title: m.title,
          type: m.type,
          order: m.order,
          questionsCount: m.questions.length,
        })),
      } : null,
    })
  } catch (error) {
    console.error("Error:", error)
    return NextResponse.json({ error: "Ошибка" }, { status: 500 })
  }
}

// PUT - Update existing UI Design modules with new content
export async function PUT() {
  try {
    const session = await getServerSession(authOptions)

    if (!session?.user?.id || session.user.role !== "ADMIN") {
      return NextResponse.json({ error: "Только админ" }, { status: 403 })
    }

    // Find existing UI Design trail
    const trail = await prisma.trail.findFirst({
      where: {
        OR: [
          { title: { contains: "UI" } },
          { slug: { contains: "ui" } },
        ],
      },
      include: {
        modules: {
          orderBy: { order: "asc" },
          include: { questions: true },
        },
      },
    })

    if (!trail) {
      return NextResponse.json({ error: "Trail UI Design не найден" }, { status: 404 })
    }

    const modules = trail.modules
    const results: string[] = []

    // Module 1: Основы UI дизайна → Gestalt principles + MATCHING exercise
    if (modules[0]) {
      await prisma.module.update({
        where: { id: modules[0].id },
        data: {
          title: "Основы UI Design",
          description: "Гештальт-принципы и визуальное восприятие",
          content: getModule1Content(),
          type: "PRACTICE",
          duration: "45 мин",
          points: 100,
        },
      })

      // Delete old questions and create new MATCHING exercise
      await prisma.question.deleteMany({ where: { moduleId: modules[0].id } })
      await prisma.question.create({
        data: {
          moduleId: modules[0].id,
          type: "MATCHING",
          question: "Сопоставьте гештальт-принципы с примерами их применения",
          options: JSON.stringify([]),
          correctAnswer: 0,
          data: JSON.stringify({
            leftLabel: "Принцип",
            rightLabel: "Пример применения",
            leftItems: [
              { id: "l1", text: "Принцип близости" },
              { id: "l2", text: "Принцип сходства" },
              { id: "l3", text: "Принцип замкнутости" },
              { id: "l4", text: "Принцип непрерывности" },
              { id: "l5", text: "Принцип фигуры и фона" },
              { id: "l6", text: "Принцип общей области" },
            ],
            rightItems: [
              { id: "r1", text: "Поля Email и Пароль расположены ближе друг к другу" },
              { id: "r2", text: "Все кликабельные ссылки выделены одним цветом" },
              { id: "r3", text: "Прогресс-бар: мозг достраивает незаполненную часть" },
              { id: "r4", text: "Wizard показывает этапы точками, соединёнными линией" },
              { id: "r5", text: "Модальное окно затемняет основной контент" },
              { id: "r6", text: "Карточка объединяет фото, название и цену в одном блоке" },
            ],
            correctPairs: { l1: "r1", l2: "r2", l3: "r3", l4: "r4", l5: "r5", l6: "r6" },
          }),
          order: 1,
        },
      })
      results.push("Module 1: Основы UI Design (MATCHING)")
    }

    // Module 2: Типографика + CASE_ANALYSIS exercise (find errors)
    if (modules[1]) {
      await prisma.module.update({
        where: { id: modules[1].id },
        data: {
          title: "Типографика",
          description: "Работа с текстом и шрифтами",
          content: getModule2Content(),
          type: "PRACTICE",
          duration: "45 мин",
          points: 100,
        },
      })

      await prisma.question.deleteMany({ where: { moduleId: modules[1].id } })
      await prisma.question.create({
        data: {
          moduleId: modules[1].id,
          type: "CASE_ANALYSIS",
          question: "Найдите ошибки в документации по типографике",
          options: JSON.stringify([]),
          correctAnswer: 0,
          data: JSON.stringify({
            caseContent: `В нашем проекте мы используем шрифты с засечками (sans-serif) для основного текста, так как они лучше читаются на экранах. Базовый размер шрифта — 16px. Для построения шкалы размеров мы используем коэффициент Minor Third (1.333), который даёт умеренный контраст между уровнями. Интерлиньяж для заголовков установлен 1.8-2.0 для лучшей воздушности. Оптимальная длина строки для текста — 100-120 символов. Трекинг — это корректировка расстояния между конкретными парами букв. В проекте используется 5 разных шрифтов для разнообразия.`,
            caseLabel: "Документация джуниор-дизайнера",
            options: [
              { id: "o1", text: "Sans-serif — это шрифты БЕЗ засечек, не с засечками", isCorrect: true, explanation: "Serif = с засечками, Sans-serif = без засечек" },
              { id: "o2", text: "Minor Third = 1.200, а 1.333 — это Perfect Fourth", isCorrect: true, explanation: "Коэффициенты: Minor Third = 1.200, Perfect Fourth = 1.333" },
              { id: "o3", text: "Интерлиньяж для заголовков должен быть 1.1-1.3, не 1.8-2.0", isCorrect: true, explanation: "Заголовки в 1-2 строки — нужен плотный интерлиньяж" },
              { id: "o4", text: "Оптимальная длина строки 45-75 символов, не 100-120", isCorrect: true, explanation: "100-120 слишком много — глаза устают" },
              { id: "o5", text: "Трекинг — расстояние между ВСЕМИ буквами, для пар — кернинг", isCorrect: true, explanation: "Tracking = все буквы, Kerning = пары" },
              { id: "o6", text: "Рекомендуется 2-3 шрифта, не 5", isCorrect: true, explanation: "5 шрифтов создают хаос" },
              { id: "o7", text: "Базовый размер 16px неправильный", isCorrect: false, explanation: "16px — стандартный базовый размер для веба" },
            ],
            minCorrectRequired: 5,
          }),
          order: 1,
        },
      })
      results.push("Module 2: Типографика (CASE_ANALYSIS)")
    }

    // Module 3: Цвет и цветовые системы (THEORY)
    if (modules[2]) {
      await prisma.module.update({
        where: { id: modules[2].id },
        data: {
          title: "Цвет и цветовые системы",
          description: "Теория цвета, контраст, доступность, тёмная тема",
          content: getModule3Content(),
          type: "THEORY",
          duration: "40 мин",
          points: 80,
        },
      })
      await prisma.question.deleteMany({ where: { moduleId: modules[2].id } })
      results.push("Module 3: Цвет (THEORY)")
    }

    // Module 4: Сетки и композиция + ORDERING exercise
    if (modules[3]) {
      await prisma.module.update({
        where: { id: modules[3].id },
        data: {
          title: "Сетки и композиция",
          description: "Сеточные системы, breakpoints, 8px grid",
          content: getModule4Content(),
          type: "PRACTICE",
          duration: "45 мин",
          points: 100,
        },
      })

      await prisma.question.deleteMany({ where: { moduleId: modules[3].id } })
      await prisma.question.create({
        data: {
          moduleId: modules[3].id,
          type: "ORDERING",
          question: "Расставьте этапы настройки сеточной системы в правильном порядке",
          options: JSON.stringify([]),
          correctAnswer: 0,
          data: JSON.stringify({
            items: [
              { id: "s1", text: "Выбрать базовый модуль (4px или 8px)" },
              { id: "s2", text: "Создать шкалу отступов" },
              { id: "s3", text: "Установить breakpoints" },
              { id: "s4", text: "Определить количество колонок" },
              { id: "s5", text: "Настроить gutters и margins" },
              { id: "s6", text: "Определить стратегии адаптации" },
              { id: "s7", text: "Протестировать на контенте" },
              { id: "s8", text: "Задокументировать для команды" },
            ],
            correctOrder: ["s1", "s2", "s3", "s4", "s5", "s6", "s7", "s8"],
          }),
          order: 1,
        },
      })
      results.push("Module 4: Сетки (ORDERING)")
    }

    // Module 5: Компоненты и UI Kit + MATCHING exercise
    if (modules[4]) {
      await prisma.module.update({
        where: { id: modules[4].id },
        data: {
          title: "Компоненты и UI Kit",
          description: "Atomic Design, состояния компонентов, UI библиотека",
          content: getModule5Content(),
          type: "PRACTICE",
          duration: "50 мин",
          points: 100,
        },
      })

      await prisma.question.deleteMany({ where: { moduleId: modules[4].id } })
      await prisma.question.create({
        data: {
          moduleId: modules[4].id,
          type: "MATCHING",
          question: "Сопоставьте состояния компонентов с визуальными индикаторами",
          options: JSON.stringify([]),
          correctAnswer: 0,
          data: JSON.stringify({
            leftLabel: "Состояние",
            rightLabel: "Визуальный индикатор",
            leftItems: [
              { id: "l1", text: "Hover" },
              { id: "l2", text: "Pressed/Active" },
              { id: "l3", text: "Focused" },
              { id: "l4", text: "Disabled" },
              { id: "l5", text: "Loading" },
              { id: "l6", text: "Error" },
            ],
            rightItems: [
              { id: "r1", text: "Изменение яркости фона, лёгкая тень" },
              { id: "r2", text: "Уменьшение яркости, эффект утопания" },
              { id: "r3", text: "Чёткий outline вокруг элемента" },
              { id: "r4", text: "Opacity 50-60%, cursor: not-allowed" },
              { id: "r5", text: "Spinner, блокировка повторных кликов" },
              { id: "r6", text: "Красная граница, иконка предупреждения" },
            ],
            correctPairs: { l1: "r1", l2: "r2", l3: "r3", l4: "r4", l5: "r5", l6: "r6" },
          }),
          order: 1,
        },
      })
      results.push("Module 5: Компоненты (MATCHING)")
    }

    // Module 6: Прототипирование и анимация + ORDERING exercise
    if (modules[5]) {
      await prisma.module.update({
        where: { id: modules[5].id },
        data: {
          title: "Прототипирование и анимация",
          description: "Lo-fi/Hi-fi прототипы, микровзаимодействия, тайминги",
          content: getModule6Content(),
          type: "PRACTICE",
          duration: "50 мин",
          points: 100,
        },
      })

      await prisma.question.deleteMany({ where: { moduleId: modules[5].id } })
      await prisma.question.create({
        data: {
          moduleId: modules[5].id,
          type: "ORDERING",
          question: "Расставьте этапы работы над прототипом в правильном порядке",
          options: JSON.stringify([]),
          correctAnswer: 0,
          data: JSON.stringify({
            items: [
              { id: "s1", text: "Определить user flows" },
              { id: "s2", text: "Создать lo-fi скетчи" },
              { id: "s3", text: "Тестирование lo-fi с командой" },
              { id: "s4", text: "Доработать до mid-fi" },
              { id: "s5", text: "Применить hi-fi дизайн" },
              { id: "s6", text: "Добавить микровзаимодействия" },
              { id: "s7", text: "Финальное юзабилити-тестирование" },
              { id: "s8", text: "Передать разработчикам" },
            ],
            correctOrder: ["s1", "s2", "s3", "s4", "s5", "s6", "s7", "s8"],
          }),
          order: 1,
        },
      })
      results.push("Module 6: Прототипирование (ORDERING)")
    }

    // Create PROJECT modules
    const maxOrder = modules.length > 0 ? Math.max(...modules.map(m => m.order)) : 6

    // Project 1: Junior (Easy)
    const existingEasyProject = await prisma.module.findFirst({
      where: { trailId: trail.id, title: { contains: "карточки товара" } }
    })

    if (!existingEasyProject) {
      await prisma.module.create({
        data: {
          trailId: trail.id,
          slug: `ui-project-product-card-${Date.now()}`,
          title: "Редизайн карточки товара",
          description: "Дизайн экрана карточки товара для интернет-магазина электроники",
          content: getEasyProjectContent(),
          type: "PROJECT",
          level: "Junior",
          order: maxOrder + 1,
          duration: "1 день",
          points: 200,
        }
      })
      results.push("Project 1: Редизайн карточки товара (Junior) - создан")
    } else {
      await prisma.module.update({
        where: { id: existingEasyProject.id },
        data: {
          title: "Редизайн карточки товара",
          description: "Дизайн экрана карточки товара для интернет-магазина электроники",
          content: getEasyProjectContent(),
          type: "PROJECT",
          level: "Junior",
          duration: "1 день",
          points: 200,
        }
      })
      results.push("Project 1: Редизайн карточки товара (Junior) - обновлён")
    }

    // Project 2: Middle (Medium - entry point)
    const existingMediumProject = await prisma.module.findFirst({
      where: { trailId: trail.id, title: { contains: "доставки еды" } }
    })

    if (!existingMediumProject) {
      await prisma.module.create({
        data: {
          trailId: trail.id,
          slug: `ui-project-food-delivery-${Date.now()}`,
          title: "Приложение доставки еды",
          description: "Мобильное приложение — основной флоу от выбора ресторана до оформления заказа",
          content: getMediumProjectContent(),
          type: "PROJECT",
          level: "Middle",
          order: maxOrder + 2,
          duration: "2 дня",
          points: 300,
        }
      })
      results.push("Project 2: Приложение доставки еды (Middle) - создан")
    } else {
      await prisma.module.update({
        where: { id: existingMediumProject.id },
        data: {
          title: "Приложение доставки еды",
          description: "Мобильное приложение — основной флоу от выбора ресторана до оформления заказа",
          content: getMediumProjectContent(),
          type: "PROJECT",
          level: "Middle",
          duration: "2 дня",
          points: 300,
        }
      })
      results.push("Project 2: Приложение доставки еды (Middle) - обновлён")
    }

    // Project 3: Senior (Hard)
    const existingHardProject = await prisma.module.findFirst({
      where: { trailId: trail.id, title: { contains: "Дизайн-система" } }
    })

    if (!existingHardProject) {
      await prisma.module.create({
        data: {
          trailId: trail.id,
          slug: `ui-project-design-system-${Date.now()}`,
          title: "Дизайн-система для банка",
          description: "Полноценная дизайн-система для мобильного банковского приложения",
          content: getHardProjectContent(),
          type: "PROJECT",
          level: "Senior",
          order: maxOrder + 3,
          duration: "2 дня",
          points: 500,
        }
      })
      results.push("Project 3: Дизайн-система для банка (Senior) - создан")
    } else {
      await prisma.module.update({
        where: { id: existingHardProject.id },
        data: {
          title: "Дизайн-система для банка",
          description: "Полноценная дизайн-система для мобильного банковского приложения",
          content: getHardProjectContent(),
          type: "PROJECT",
          level: "Senior",
          duration: "2 дня",
          points: 500,
        }
      })
      results.push("Project 3: Дизайн-система для банка (Senior) - обновлён")
    }

    return NextResponse.json({
      success: true,
      message: "UI Design модули и проекты обновлены",
      trailId: trail.id,
      updated: results,
    })
  } catch (error) {
    console.error("Update error:", error)
    return NextResponse.json({ error: "Ошибка обновления" }, { status: 500 })
  }
}

// ============================================
// MODULE CONTENT FUNCTIONS
// ============================================

function getModule1Content(): string {
  return `# Основы UI Design и принципы визуального восприятия

## Введение в UI Design

UI Design (User Interface Design) — это дисциплина, которая занимается созданием визуальных интерфейсов цифровых продуктов. В отличие от UX Design, который фокусируется на общем пользовательском опыте, UI Design концентрируется на визуальном представлении: как выглядят кнопки, какие цвета используются, как организована информация на экране.

### Ключевые компетенции UI-дизайнера

- Понимание принципов визуального восприятия
- Работа с типографикой
- Создание цветовых схем
- Построение сеток и композиции
- Создание компонентов интерфейса
- Систематизация в дизайн-системы

---

## Различия между UI и UX

| Аспект | UX Design | UI Design |
|--------|-----------|-----------|
| Фокус | Весь опыт взаимодействия | Визуальное воплощение |
| Задачи | Исследования, архитектура, вайрфреймы | Цвета, типографика, иконки, анимации |
| Результат | Схематичные макеты | Финальные визуальные макеты |

> **Важно:** Красивый интерфейс не гарантирует хороший UX, но плохой визуальный дизайн может существенно ухудшить даже продуманный опыт.

---

## Гештальт-принципы в UI Design

Гештальт-психология изучает, как человеческий мозг воспринимает визуальную информацию. Эти принципы критически важны для UI-дизайнера.

### Принцип близости (Proximity)

Элементы, расположенные близко друг к другу, воспринимаются как связанная группа.

**Применение:** В форме регистрации поля "Имя" и "Фамилия" располагаются близко (личные данные), а "Email" и "Пароль" — отдельной группой (данные для входа).

### Принцип сходства (Similarity)

Элементы с похожими визуальными характеристиками воспринимаются как принадлежащие к одной группе.

**Применение:** Все кликабельные ссылки выделяются одним цветом (обычно синим), все основные кнопки имеют одинаковый стиль.

### Принцип замкнутости (Closure)

Мозг стремится завершить незаконченные формы и видеть целые объекты.

**Применение:** Карточки могут не иметь явной границы — достаточно тени. Прогресс-бары используют этот принцип: мозг "достраивает" незаполненную часть.

### Принцип непрерывности (Continuity)

Глаз естественно следует линиям и последовательностям элементов.

**Применение:** Навигационные меню в линию. Wizard показывает этапы пронумерованными точками, соединёнными линией.

### Принцип фигуры и фона (Figure-Ground)

Мозг автоматически разделяет информацию на главный объект (фигуру) и окружение (фон).

**Применение:** Модальные окна затемняют основной контент, делая модалку "фигурой". Кнопки "выступают" благодаря теням.

### Принцип общей области (Common Region)

Элементы внутри одной визуально обозначенной области воспринимаются как группа.

**Применение:** Карточки товаров объединяют изображение, название, цену и кнопку в одну визуальную область.

---

## Визуальная иерархия

Визуальная иерархия — способ организации элементов так, чтобы пользователь воспринимал их в определённом порядке важности.

### Инструменты создания иерархии

| Инструмент | Как работает |
|------------|--------------|
| **Размер** | Крупные элементы привлекают внимание первыми |
| **Цвет и контраст** | Яркие цвета выделяются на фоне приглушённых |
| **Позиция** | Верх и лево воспринимаются первыми |
| **Whitespace** | Элемент с пустым пространством кажется важнее |
| **Типографика** | Жирность, размер создают иерархию текста |

---

## Паттерны сканирования

### F-паттерн

Для страниц с большим количеством текста:
1. Горизонтальное чтение верхней части
2. Ещё одна горизонтальная линия (короче)
3. Вертикальное сканирование левой стороны

### Z-паттерн

Для лендингов с минимальным текстом:
- Левый верх → Правый верх → Диагональ вниз → Правый низ

---

## Ключевые выводы

1. **UI ≠ UX**, но UI критически влияет на UX
2. **Гештальт-принципы** объясняют, как пользователи воспринимают интерфейс
3. **Визуальная иерархия** направляет внимание пользователя
4. **Паттерны сканирования** помогают размещать информацию правильно

---

## Задание

Сопоставьте гештальт-принципы с примерами их применения в интерфейсах.`
}

function getModule2Content(): string {
  return `# Типографика и работа с текстом

## Роль типографики в UI Design

Типографика — искусство оформления текста. В цифровых интерфейсах текст составляет **до 95% контента**, поэтому типографика — один из важнейших инструментов UI-дизайнера.

---

## Анатомия шрифта

### Основные элементы

| Элемент | Описание |
|---------|----------|
| **Baseline** | Линия, на которой "стоят" буквы |
| **X-height** | Высота строчной буквы "x" |
| **Cap height** | Высота заглавных букв |
| **Ascenders** | Части букв выше x-height (b, d, h) |
| **Descenders** | Части букв ниже baseline (g, p, y) |
| **Serifs** | Засечки на концах штрихов |

### Метрики

- **Кегль** — размер шрифта (px для экрана)
- **Начертание (weight)** — толщина: Light, Regular, Medium, Bold, Black
- **Трекинг (tracking)** — расстояние между ВСЕМИ буквами
- **Кернинг (kerning)** — расстояние между КОНКРЕТНЫМИ парами букв
- **Интерлиньяж (line-height)** — расстояние между строками

---

## Классификация шрифтов

### Serif (с засечками)

Классические шрифты. Надёжность, традиции, академичность.

**Примеры:** Times New Roman, Georgia, Playfair Display

### Sans-serif (без засечек)

Современные шрифты. Чистота, технологичность.

**Примеры:** Helvetica, Roboto, Inter, SF Pro

### Monospace (моноширинные)

Каждый символ одинаковой ширины. Для кода.

**Примеры:** Consolas, JetBrains Mono, Fira Code

---

## Модульная шкала размеров

| Название | Коэффициент |
|----------|-------------|
| Minor Second | 1.067 |
| Major Second | 1.125 |
| **Minor Third** | **1.200** |
| Major Third | 1.250 |
| **Perfect Fourth** | **1.333** |
| Golden Ratio | 1.618 |

### Пример Minor Third (1.200)

База 16px → 16, 19, 23, 28, 33, 40px

---

## Интерлиньяж и длина строки

### Интерлиньяж (line-height)

| Контекст | Рекомендация |
|----------|--------------|
| Заголовки | 1.1 – 1.3 |
| Основной текст | 1.5 – 1.6 |
| Мелкий текст | 1.3 – 1.4 |

### Длина строки

**Оптимум: 45–75 символов** (идеально ~66)

---

## Комбинирование шрифтов

1. **Максимум 2-3 шрифта** в проекте
2. **Контраст работает лучше:** serif + sans-serif
3. Проверьте наличие нужных начертаний

> **Совет:** В 90% проектов достаточно одного хорошего шрифта с несколькими начертаниями.

---

## Ключевые выводы

1. **Трекинг ≠ Кернинг.** Трекинг — все буквы, кернинг — пары.
2. **Minor Third = 1.200**, Perfect Fourth = 1.333
3. **45-75 символов** — оптимальная длина строки
4. **2-3 шрифта максимум**

---

## Задание

Найдите все ошибки в документации джуниор-дизайнера по типографике.`
}

function getModule3Content(): string {
  return `# Цвет и цветовые системы

## Цветовые модели

### RGB / HEX

RGB — для экранов (0-255). HEX — шестнадцатеричный формат (#RRGGBB).

### HSL (Hue, Saturation, Lightness)

Интуитивная модель:
- **Hue** (0–360°) — оттенок на цветовом круге
- **Saturation** (0–100%) — насыщенность
- **Lightness** (0–100%) — светлота

---

## Цветовые гармонии

| Гармония | Описание |
|----------|----------|
| **Монохроматическая** | Один оттенок, разная светлота |
| **Аналоговая** | Соседние оттенки на круге |
| **Комплементарная** | Противоположные цвета |
| **Триада** | Три равноудалённых цвета |

---

## Структура палитры

- **Primary** — главный цвет бренда
- **Secondary** — дополнительный акцент
- **Neutral** — оттенки серого (8-12 ступеней)
- **Semantic** — Success (зелёный), Warning (жёлтый), Error (красный), Info (синий)

---

## Контраст и доступность (WCAG)

| Уровень | Обычный текст | Крупный текст |
|---------|---------------|---------------|
| **AA** | 4.5:1 | 3:1 |
| **AAA** | 7:1 | 4.5:1 |

---

## Тёмная тема

### Принципы

1. НЕ инвертируйте механически
2. Тёмно-серый (#121212), не чёрный (#000)
3. Elevation наоборот — выше = светлее
4. Уменьшите насыщенность ярких цветов

### Рекомендуемые значения

| Элемент | Цвет |
|---------|------|
| Фон основной | #121212 – #1E1E1E |
| Текст основной | rgba(255,255,255,0.87) |
| Текст вторичный | rgba(255,255,255,0.60) |

---

## Дизайн-токены

Используйте семантические переменные:

\`\`\`css
/* Хорошо */
color: var(--color-text-secondary);

/* Плохо */
color: #6B7280;
\`\`\`

---

## Ключевые выводы

1. **HSL интуитивнее RGB** для дизайнеров
2. **WCAG AA = 4.5:1** для обычного текста
3. **В тёмной теме** elevation работает наоборот
4. **Warning = жёлтый**, Error = красный`
}

function getModule4Content(): string {
  return `# Сетки и композиция

## Анатомия сетки

| Элемент | Описание | Значения |
|---------|----------|----------|
| **Columns** | Вертикальные секции | 12/8/4 |
| **Gutters** | Между колонками | 16-24px |
| **Margins** | По краям экрана | 16-32px |
| **Module** | Базовая единица | 4px или 8px |

---

## Типы сеток

- **Колоночная** — 12 колонок (стандарт)
- **Модульная** — + горизонтальные деления
- **Иерархическая** — под конкретный контент
- **Baseline** — привязка к интерлиньяжу

---

## Система 8px

### Шкала отступов

\`\`\`
4px   — минимальный
8px   — базовый
16px  — между элементами
24px  — между группами
32px  — между секциями
48px+ — крупные разделы
\`\`\`

---

## Breakpoints

| Устройство | Ширина | Колонки |
|------------|--------|---------|
| Mobile | 320–767px | 4 |
| Tablet | 768–1023px | 8 |
| Desktop | 1024px+ | 12 |

### Стратегии адаптации

- **Reflow** — меняется расположение
- **Resize** — масштабирование
- **Reveal/Hide** — показать/скрыть
- **Reposition** — смена позиции

---

## Правила композиции

- **Правило третей** — важное на пересечениях
- **Золотое сечение** — пропорция 1:1.618
- **Визуальный баланс** — симметрия vs асимметрия

---

## Порядок настройки сетки

1. Выбрать базовый модуль
2. Создать шкалу отступов
3. Установить breakpoints
4. Определить колонки
5. Настроить gutters/margins
6. Стратегии адаптации
7. Тестирование
8. Документация

---

## Задание

Расставьте этапы настройки сеточной системы в правильном порядке.`
}

function getModule5Content(): string {
  return `# Компоненты и UI Kit

## Atomic Design

| Уровень | Описание | Примеры |
|---------|----------|---------|
| **Атомы** | Базовые элементы | Кнопка, input, иконка |
| **Молекулы** | Группы атомов | Поле поиска |
| **Организмы** | Сложные компоненты | Шапка сайта |
| **Шаблоны** | Структура страницы | Макет лендинга |
| **Страницы** | С реальным контентом | Готовая страница |

---

## Состояния компонентов

| Состояние | Визуальный индикатор |
|-----------|---------------------|
| **Default** | Базовый стиль |
| **Hover** | Изменение яркости, тень |
| **Pressed** | Уменьшение яркости, inset shadow |
| **Focused** | Чёткий outline |
| **Disabled** | Opacity 50-60%, cursor: not-allowed |
| **Loading** | Spinner, блокировка кликов |
| **Error** | Красная граница |

> **Важно:** Никогда не убирайте focus outline — это для доступности!

---

## Основные компоненты

### Кнопки

| Тип | Использование |
|-----|---------------|
| **Primary** | Главное действие |
| **Secondary** | Альтернатива |
| **Tertiary** | Наименее важное |
| **Destructive** | Опасное действие |

**Touch target:** минимум 44×44px

### Формы

Text Input, Textarea, Select, Checkbox, Radio, Toggle, Date Picker, Slider

### Навигация

Navigation Bar, Tabs, Breadcrumbs, Pagination, Bottom Navigation

### Обратная связь

Toast, Alert, Modal, Tooltip, Progress Bar, Skeleton

---

## Организация UI Kit

\`\`\`
Foundation/
  Colors, Typography, Icons, Spacing

Components/
  Buttons, Inputs, Navigation, Cards

Patterns/
  Login Form, Product Card

Templates/
  Page Layouts
\`\`\`

---

## Задание

Сопоставьте состояния компонентов с визуальными индикаторами.`
}

function getModule6Content(): string {
  return `# Прототипирование и анимация

## Уровни прототипов

| Уровень | Описание | Когда |
|---------|----------|-------|
| **Lo-fi** | Схематичные, ч/б | Ранние этапы |
| **Mid-fi** | С типографикой и текстом | После валидации |
| **Hi-fi** | Финальный дизайн | Перед разработкой |

---

## Типы переходов

- **Instant** — мгновенный
- **Dissolve** — fade
- **Smart Animate** — автоматическая анимация (Figma)
- **Slide/Push** — скольжение

---

## Принципы анимации

| Принцип | Применение |
|---------|------------|
| **Easing** | Плавное начало/конец |
| **Anticipation** | Подготовительное движение |
| **Staging** | Направление внимания |
| **Timing** | Скорость влияет на восприятие |

---

## Тайминг

| Тип | Длительность |
|-----|--------------|
| Hover, focus | 100–200ms |
| Dropdown | 200–300ms |
| Модальные окна | 300–400ms |
| Смена экрана | 400–500ms |

### Кривые (Easing)

- **Linear** — редко используется
- **Ease-in** — для уходящих элементов
- **Ease-out** — для появляющихся
- **Ease-in-out** — универсальный

---

## Микровзаимодействия

- Pull-to-refresh
- Like animation
- Form validation
- Password strength
- Loading states
- Swipe actions

---

## Лучшие практики

### Производительность

- Анимируйте только **transform** и **opacity**
- Избегайте width, height, top, left

### Доступность

- Учитывайте **prefers-reduced-motion**
- Не мигайте чаще 3 раз в секунду

---

## Порядок работы

1. Определить user flows
2. Lo-fi скетчи
3. Тестирование lo-fi
4. Mid-fi прототип
5. Hi-fi дизайн
6. Микровзаимодействия
7. Финальное тестирование
8. Handoff разработчикам

---

## Задание

Расставьте этапы работы над прототипом в правильном порядке.`
}

function getMediumProjectContent(): string {
  return `# Проект: Мобильное приложение доставки еды

**Срок выполнения:** 2 дня
**Сложность:** Средняя

---

## Задание

Создайте дизайн мобильного приложения доставки еды. Спроектируйте полный пользовательский путь от выбора ресторана до оформления заказа.

---

## Обязательные экраны (6 штук)

### 1. Главный экран (Home)
- Поиск ресторанов/блюд
- Категории кухни (горизонтальный скролл)
- Промо-баннеры
- Список рекомендуемых ресторанов (карточки)
- Bottom navigation

### 2. Страница ресторана
- Шапка с фото, названием, рейтингом, временем доставки
- Табы с категориями меню
- Список блюд с фото, описанием, ценой
- Плавающая кнопка корзины (с количеством и суммой)

### 3. Карточка блюда (детали)
- Большое фото блюда
- Название, описание, состав
- Выбор размера/опций (если применимо)
- Выбор дополнений (добавки, соусы)
- Счётчик количества
- Кнопка "Добавить в корзину" с ценой

### 4. Корзина
- Список добавленных блюд с изменением количества
- Удаление позиций (swipe-to-delete или кнопка)
- Поле для промокода
- Расчёт итоговой суммы (блюда + доставка + скидка)
- Кнопка оформления заказа

### 5. Оформление заказа (Checkout)
- Выбор/добавление адреса доставки
- Выбор времени доставки (ASAP или к времени)
- Выбор способа оплаты
- Комментарий к заказу
- Итоговая сумма и кнопка подтверждения

### 6. Подтверждение заказа (Success)
- Анимация/иллюстрация успеха
- Номер заказа
- Ожидаемое время доставки
- Кнопка отслеживания заказа
- Кнопка возврата на главную

---

## Дополнительные требования

### Компоненты и состояния

Создайте отдельную страницу с UI компонентами (мини-UI Kit):

| Компонент | Состояния |
|-----------|-----------|
| **Кнопки** | Primary, Secondary, Ghost — все размеры |
| **Состояния кнопок** | default, hover, pressed, disabled, loading |
| **Поля ввода** | default, focused, error, filled |
| **Карточки** | ресторана, блюда, корзины |
| **Bottom navigation** | с состояниями |

### Технические требования

- **Размер:** iPhone 14 Pro (393 × 852 px)
- **Сетка:** 8px система отступов
- **Цвета:** минимум 2 оттенка primary
- **Контраст:** WCAG AA
- **Компоненты:** Figma Components с Auto Layout

### Интерактивность

- Кликабельный прототип с навигацией
- Минимум **3 микровзаимодействия**:
  - Добавление в корзину
  - Переключение табов
  - Успешное оформление

---

## Критерии оценки

1. Логичность и полнота пользовательского флоу
2. Визуальная иерархия и читаемость
3. Консистентность компонентов
4. Качество состояний и edge-cases
5. Продуманность микровзаимодействий
6. Организация Figma-файла
7. Общая эстетика и внимание к деталям`
}

function getEasyProjectContent(): string {
  return `# Проект: Редизайн карточки товара

**Срок выполнения:** 1 день
**Сложность:** Простая

> Этот проект назначается при недостаточных результатах проекта средней сложности.

---

## Задание

Создайте дизайн **одного экрана** — карточки товара для мобильного приложения интернет-магазина электроники.

Экран должен содержать всю информацию для принятия решения о покупке.

---

## Обязательные элементы экрана

| Элемент | Описание |
|---------|----------|
| **Галерея** | Минимум 3 фото с индикатором |
| **Название** | Товар и краткое описание |
| **Цена** | Текущая и старая (если скидка) |
| **Рейтинг** | Звёзды и количество отзывов |
| **Варианты** | Выбор цвета или объёма памяти |
| **Кнопки** | "Добавить в корзину" и "Купить сейчас" |
| **Характеристики** | 4-6 параметров |
| **Отзывы** | Превью 2-3 отзывов |

---

## Требования к компонентам

Создайте компоненты для:
- Кнопок (2 типа)
- Карточки характеристики
- Карточки отзыва

### Состояния

| Компонент | Состояния |
|-----------|-----------|
| **Кнопки** | default, pressed, disabled |
| **Варианты** | selected, unselected |

---

## Технические требования

- **Размер:** iPhone 14 Pro (393 × 852 px)
- **Сетка:** 8px система отступов
- **Контраст:** WCAG AA

---

## Критерии оценки

1. Визуальная иерархия информации
2. Качество компонентов и их состояний
3. Соблюдение типографических принципов
4. Аккуратность исполнения`
}

function getHardProjectContent(): string {
  return `# Проект: Дизайн-система для банковского приложения

**Срок выполнения:** 2 дня
**Сложность:** Высокая

> Этот проект назначается при отличных результатах проекта средней сложности.

---

## Задание

Разработайте полноценную дизайн-систему для мобильного банковского приложения. Система должна быть гибкой для создания любых экранов и включать **тёмную тему**.

---

## Часть 1: Foundation (Основа)

### Цветовая система

| Палитра | Требования |
|---------|------------|
| **Primary** | 10 оттенков (50-900) |
| **Secondary** | 10 оттенков |
| **Neutral** | 12 оттенков (текст, фоны, границы) |
| **Semantic** | Success, Warning, Error, Info — по 5 оттенков |

> Все цвета должны работать в светлой И тёмной теме

### Типографика

- Модульная шкала размеров (минимум 7 уровней)
- Стили: Display, Heading 1-4, Body Large/Regular/Small, Caption, Overline
- Каждый стиль: size, weight, line-height, letter-spacing

### Остальные токены

| Токен | Значения |
|-------|----------|
| **Spacing** | 4, 8, 12, 16, 24, 32, 48, 64, 80, 96 |
| **Border radius** | 4 уровня (small, medium, large, full) |
| **Shadows** | 4 уровня elevation |
| **Иконки** | Минимум 30 для банковского приложения |

---

## Часть 2: Components (Компоненты)

### Базовые компоненты

| Компонент | Варианты |
|-----------|----------|
| **Buttons** | Primary, Secondary, Tertiary, Destructive, Icon-only — 3 размера, все состояния |
| **Inputs** | Text, Password, Number, Search — все состояния включая error |
| **Selects** | Dropdown, Date picker |
| **Toggles** | Checkbox, Radio, Switch |

### Навигация

- Top navigation bar (варианты: title only, back + title, back + title + action)
- Bottom navigation (5 табов)
- Tabs (внутри экрана)

### Карточки и контейнеры

- Карточка счёта/карты
- Карточка транзакции
- Карточка быстрого действия
- Bottom sheet
- Modal dialog

### Обратная связь

- Toast уведомления (success, error, warning, info)
- Alert banners
- Empty states
- Loading states (spinner, skeleton)

### Специфичные для финтеха

- Графики: линейный, круговой/donut
- Numpad для ввода сумм
- Amount input (большие цифры)

---

## Часть 3: Демонстрационные экраны (6 штук)

1. **Dashboard** — баланс, карты, быстрые действия, транзакции, график
2. **Все транзакции** — список с фильтрами и поиском
3. **Детали транзакции** — полная информация
4. **Перевод — ввод данных** — выбор получателя, ввод суммы
5. **Перевод — подтверждение** — проверка данных
6. **Перевод — успех** — подтверждение операции

---

## Часть 4: Дополнительные требования

- ✅ Все экраны в светлой **И** тёмной теме
- ✅ Кликабельный прототип флоу перевода денег
- ✅ Минимум **5 микровзаимодействий** (анимированных)
- ✅ Документация: описание использования каждой категории
- ✅ Do's and Don'ts для ключевых компонентов

---

## Критерии оценки

1. Полнота и системность дизайн-системы
2. Качество отдельных компонентов и состояний
3. Корректность тёмной темы (не просто инверсия)
4. Качество демонстрационных экранов
5. Качество и продуманность анимаций
6. Документация и организация файла
7. Общий уровень исполнения`
}
