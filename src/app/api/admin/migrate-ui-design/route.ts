import { NextResponse } from "next/server"
import { getServerSession } from "next-auth"
import { authOptions } from "@/lib/auth"
import { prisma } from "@/lib/prisma"

// Migration for UI Design trail with comprehensive content
export async function POST() {
  try {
    const session = await getServerSession(authOptions)

    if (!session?.user?.id || session.user.role !== "ADMIN") {
      return NextResponse.json({ error: "Только админ" }, { status: 403 })
    }

    // Find or create UI Design trail
    let uiDesignTrail = await prisma.trail.findFirst({
      where: { slug: "ui-design" },
    })

    if (!uiDesignTrail) {
      const maxOrder = await prisma.trail.aggregate({
        _max: { order: true },
      })

      uiDesignTrail = await prisma.trail.create({
        data: {
          slug: "ui-design",
          title: "UI Design",
          subtitle: "Полный курс",
          description: "Освойте UI-дизайн: от гештальт-принципов до прототипирования",
          icon: "Palette",
          color: "#8B5CF6",
          duration: "6 модулей",
          order: (maxOrder._max.order || 0) + 1,
          isPublished: true,
          isRestricted: false,
        },
      })
    }

    // Check if modules already exist
    const existingModules = await prisma.module.findMany({
      where: { trailId: uiDesignTrail.id },
    })

    if (existingModules.length > 0) {
      return NextResponse.json({ message: "Модули уже существуют. Используйте PUT для обновления контента.", skipped: true })
    }

    // Create 6 modules with exercises
    const modules = [
      {
        slug: `ui-design-basics-${Date.now()}`,
        title: "Основы UI Design",
        description: "Гештальт-принципы и визуальное восприятие",
        type: "PRACTICE",
        level: "Beginner",
        points: 100,
        duration: "45 мин",
        order: 1,
        content: getModule1Content(),
        questionType: "MATCHING",
        questionText: "Сопоставьте гештальт-принципы с примерами их применения",
        questionData: {
          leftLabel: "Принцип",
          rightLabel: "Пример применения",
          leftItems: [
            { id: "l1", text: "Принцип близости" },
            { id: "l2", text: "Принцип сходства" },
            { id: "l3", text: "Принцип замкнутости" },
            { id: "l4", text: "Принцип непрерывности" },
            { id: "l5", text: "Принцип фигуры и фона" },
            { id: "l6", text: "Принцип общей области" },
          ],
          rightItems: [
            { id: "r1", text: "Поля Email и Пароль расположены ближе друг к другу, чем к полю Имя" },
            { id: "r2", text: "Все кликабельные ссылки выделены одним синим цветом" },
            { id: "r3", text: "Прогресс-бар показывает заполненную часть, мозг достраивает остальное" },
            { id: "r4", text: "Wizard показывает этапы в виде точек, соединённых линией" },
            { id: "r5", text: "Модальное окно затемняет основной контент позади" },
            { id: "r6", text: "Карточка товара объединяет фото, название и цену внутри блока с тенью" },
          ],
          correctPairs: {
            l1: "r1",
            l2: "r2",
            l3: "r3",
            l4: "r4",
            l5: "r5",
            l6: "r6",
          },
        },
      },
      {
        slug: `ui-design-typography-${Date.now()}`,
        title: "Типографика",
        description: "Работа с текстом и шрифтами",
        type: "PRACTICE",
        level: "Beginner",
        points: 100,
        duration: "45 мин",
        order: 2,
        content: getModule2Content(),
        questionType: "CASE_ANALYSIS",
        questionText: "Найдите ошибки в документации по типографике",
        questionData: {
          caseContent: `В нашем проекте мы используем шрифты с засечками (sans-serif) для основного текста, так как они лучше читаются на экранах. Базовый размер шрифта — 16px. Для построения шкалы размеров мы используем коэффициент Minor Third (1.333), который даёт умеренный контраст между уровнями. Интерлиньяж для заголовков установлен 1.8-2.0 для лучшей воздушности. Оптимальная длина строки для текста — 100-120 символов, поэтому мы ограничиваем ширину текстовых блоков 900px. Трекинг — это корректировка расстояния между конкретными парами букв (например, AV или To). В проекте используется 5 разных шрифтов для создания визуального разнообразия.`,
          caseLabel: "Документация джуниор-дизайнера",
          options: [
            {
              id: "o1",
              text: "Sans-serif — это шрифты БЕЗ засечек, не с засечками",
              isCorrect: true,
              explanation: "Serif = с засечками, Sans-serif = без засечек (sans = без)",
            },
            {
              id: "o2",
              text: "Minor Third = 1.200, а 1.333 — это Perfect Fourth",
              isCorrect: true,
              explanation: "Коэффициенты модульной шкалы: Minor Third = 1.200, Perfect Fourth = 1.333",
            },
            {
              id: "o3",
              text: "Интерлиньяж для заголовков должен быть 1.1-1.3, не 1.8-2.0",
              isCorrect: true,
              explanation: "Заголовки обычно в 1-2 строки, им нужен плотный интерлиньяж",
            },
            {
              id: "o4",
              text: "Оптимальная длина строки 45-75 символов, не 100-120",
              isCorrect: true,
              explanation: "100-120 символов слишком много — глаза устают при переходе на новую строку",
            },
            {
              id: "o5",
              text: "Трекинг — равномерное расстояние между ВСЕМИ буквами, для пар — это кернинг",
              isCorrect: true,
              explanation: "Tracking = все буквы, Kerning = конкретные пары (AV, To, etc.)",
            },
            {
              id: "o6",
              text: "Рекомендуется 2-3 шрифта в проекте, не 5",
              isCorrect: true,
              explanation: "5 шрифтов создают хаос, достаточно 2-3 (заголовки, текст, код)",
            },
            {
              id: "o7",
              text: "Базовый размер 16px — это неправильно, нужно 14px",
              isCorrect: false,
              explanation: "16px — стандартный базовый размер для веба, это корректно",
            },
          ],
          minCorrectRequired: 5,
        },
      },
      {
        slug: `ui-design-color-${Date.now()}`,
        title: "Цвет и цветовые системы",
        description: "Теория цвета, контраст и доступность",
        type: "THEORY",
        level: "Beginner",
        points: 80,
        duration: "40 мин",
        order: 3,
        content: getModule3Content(),
        questionType: null,
        questionText: null,
        questionData: null,
      },
      {
        slug: `ui-design-grids-${Date.now()}`,
        title: "Сетки и композиция",
        description: "Сеточные системы и адаптивный дизайн",
        type: "PRACTICE",
        level: "Intermediate",
        points: 100,
        duration: "45 мин",
        order: 4,
        content: getModule4Content(),
        questionType: "ORDERING",
        questionText: "Расставьте этапы настройки сеточной системы в правильном порядке",
        questionData: {
          items: [
            { id: "s1", text: "Выбрать базовый модуль системы (4px или 8px)" },
            { id: "s2", text: "Создать шкалу отступов на основе базового модуля" },
            { id: "s3", text: "Установить breakpoints для mobile, tablet, desktop" },
            { id: "s4", text: "Определить количество колонок для каждого breakpoint" },
            { id: "s5", text: "Настроить gutters и margins для каждого breakpoint" },
            { id: "s6", text: "Определить стратегии адаптации компонентов" },
            { id: "s7", text: "Протестировать сетку на реальном контенте" },
            { id: "s8", text: "Задокументировать систему для команды" },
          ],
          correctOrder: ["s1", "s2", "s3", "s4", "s5", "s6", "s7", "s8"],
        },
      },
      {
        slug: `ui-design-components-${Date.now()}`,
        title: "Компоненты и UI Kit",
        description: "Создание и организация компонентов",
        type: "PRACTICE",
        level: "Intermediate",
        points: 100,
        duration: "50 мин",
        order: 5,
        content: getModule5Content(),
        questionType: "MATCHING",
        questionText: "Сопоставьте состояния компонентов с визуальными индикаторами",
        questionData: {
          leftLabel: "Состояние",
          rightLabel: "Визуальный индикатор",
          leftItems: [
            { id: "l1", text: "Hover" },
            { id: "l2", text: "Pressed/Active" },
            { id: "l3", text: "Focused" },
            { id: "l4", text: "Disabled" },
            { id: "l5", text: "Loading" },
            { id: "l6", text: "Error" },
          ],
          rightItems: [
            { id: "r1", text: "Небольшое изменение яркости фона, лёгкая тень" },
            { id: "r2", text: "Уменьшение яркости, эффект утопания (inset shadow)" },
            { id: "r3", text: "Чёткий outline вокруг элемента" },
            { id: "r4", text: "Пониженная непрозрачность (50-60%), курсор not-allowed" },
            { id: "r5", text: "Spinner внутри кнопки, блокировка повторных кликов" },
            { id: "r6", text: "Красная граница, иконка предупреждения" },
          ],
          correctPairs: {
            l1: "r1",
            l2: "r2",
            l3: "r3",
            l4: "r4",
            l5: "r5",
            l6: "r6",
          },
        },
      },
      {
        slug: `ui-design-prototyping-${Date.now()}`,
        title: "Прототипирование и анимация",
        description: "Создание интерактивных прототипов",
        type: "PRACTICE",
        level: "Intermediate",
        points: 100,
        duration: "50 мин",
        order: 6,
        content: getModule6Content(),
        questionType: "ORDERING",
        questionText: "Расставьте этапы работы над прототипом в правильном порядке",
        questionData: {
          items: [
            { id: "s1", text: "Определить ключевые пользовательские сценарии (user flows)" },
            { id: "s2", text: "Создать lo-fi скетчи основных экранов" },
            { id: "s3", text: "Провести быстрое тестирование lo-fi с командой" },
            { id: "s4", text: "Доработать до mid-fi прототипа с реальным текстом" },
            { id: "s5", text: "Применить визуальный дизайн (hi-fi) на основе UI Kit" },
            { id: "s6", text: "Добавить микровзаимодействия и анимации" },
            { id: "s7", text: "Провести финальное юзабилити-тестирование" },
            { id: "s8", text: "Передать прототип разработчикам с документацией" },
          ],
          correctOrder: ["s1", "s2", "s3", "s4", "s5", "s6", "s7", "s8"],
        },
      },
    ]

    const createdModules = []

    for (const mod of modules) {
      const { questionType, questionText, questionData, ...moduleData } = mod

      const createdModule = await prisma.module.create({
        data: {
          ...moduleData,
          trailId: uiDesignTrail.id,
        },
      })

      // Create question if exists
      if (questionType && questionData) {
        await prisma.question.create({
          data: {
            moduleId: createdModule.id,
            type: questionType,
            question: questionText || "",
            options: JSON.stringify([]),
            correctAnswer: 0,
            data: JSON.stringify(questionData),
            order: 1,
          },
        })
      }

      createdModules.push(createdModule.title)
    }

    return NextResponse.json({
      success: true,
      message: "UI Design модули созданы",
      modules: createdModules,
    })
  } catch (error) {
    console.error("Migration error:", error)
    return NextResponse.json({ error: "Ошибка миграции" }, { status: 500 })
  }
}

// PUT - Update existing module content
export async function PUT() {
  try {
    const session = await getServerSession(authOptions)

    if (!session?.user?.id || session.user.role !== "ADMIN") {
      return NextResponse.json({ error: "Только админ" }, { status: 403 })
    }

    const updates = [
      { title: "Основы UI Design", content: getModule1Content() },
      { title: "Типографика", content: getModule2Content() },
      { title: "Цвет и цветовые системы", content: getModule3Content() },
      { title: "Сетки и композиция", content: getModule4Content() },
      { title: "Компоненты и UI Kit", content: getModule5Content() },
      { title: "Прототипирование и анимация", content: getModule6Content() },
    ]

    const results = []
    for (const update of updates) {
      const mod = await prisma.module.findFirst({
        where: { title: update.title },
      })
      if (mod) {
        await prisma.module.update({
          where: { id: mod.id },
          data: { content: update.content },
        })
        results.push(update.title)
      }
    }

    return NextResponse.json({
      success: true,
      message: "Контент обновлён",
      updated: results,
    })
  } catch (error) {
    console.error("Update error:", error)
    return NextResponse.json({ error: "Ошибка обновления" }, { status: 500 })
  }
}

// ============================================
// MODULE CONTENT FUNCTIONS
// ============================================

function getModule1Content(): string {
  return `# Основы UI Design и принципы визуального восприятия

## Введение в UI Design

UI Design (User Interface Design) — это дисциплина, которая занимается созданием визуальных интерфейсов цифровых продуктов. В отличие от UX Design, который фокусируется на общем пользовательском опыте, UI Design концентрируется на визуальном представлении: как выглядят кнопки, какие цвета используются, как организована информация на экране.

### Ключевые компетенции UI-дизайнера

- Понимание принципов визуального восприятия
- Работа с типографикой
- Создание цветовых схем
- Построение сеток и композиции
- Создание компонентов интерфейса
- Систематизация в дизайн-системы

---

## Различия между UI и UX

| Аспект | UX Design | UI Design |
|--------|-----------|-----------|
| Фокус | Весь опыт взаимодействия | Визуальное воплощение |
| Задачи | Исследования, архитектура, вайрфреймы | Цвета, типографика, иконки, анимации |
| Результат | Схематичные макеты | Финальные визуальные макеты |

> **Важно:** Красивый интерфейс не гарантирует хороший UX, но плохой визуальный дизайн может существенно ухудшить даже продуманный опыт.

---

## Гештальт-принципы в UI Design

Гештальт-психология изучает, как человеческий мозг воспринимает визуальную информацию. Эти принципы критически важны для UI-дизайнера.

### Принцип близости (Proximity)

Элементы, расположенные близко друг к другу, воспринимаются как связанная группа.

**Применение:** В форме регистрации поля "Имя" и "Фамилия" располагаются близко (личные данные), а "Email" и "Пароль" — отдельной группой (данные для входа).

### Принцип сходства (Similarity)

Элементы с похожими визуальными характеристиками воспринимаются как принадлежащие к одной группе.

**Применение:** Все кликабельные ссылки выделяются одним цветом (обычно синим), все основные кнопки имеют одинаковый стиль.

### Принцип замкнутости (Closure)

Мозг стремится завершить незаконченные формы и видеть целые объекты.

**Применение:** Карточки могут не иметь явной границы — достаточно тени. Прогресс-бары используют этот принцип: мозг "достраивает" незаполненную часть.

### Принцип непрерывности (Continuity)

Глаз естественно следует линиям и последовательностям элементов.

**Применение:** Навигационные меню в линию. Wizard показывает этапы пронумерованными точками, соединёнными линией.

### Принцип фигуры и фона (Figure-Ground)

Мозг автоматически разделяет информацию на главный объект (фигуру) и окружение (фон).

**Применение:** Модальные окна затемняют основной контент, делая модалку "фигурой". Кнопки "выступают" благодаря теням.

### Принцип общей области (Common Region)

Элементы внутри одной визуально обозначенной области воспринимаются как группа.

**Применение:** Карточки товаров объединяют изображение, название, цену и кнопку в одну визуальную область.

---

## Визуальная иерархия

Визуальная иерархия — способ организации элементов так, чтобы пользователь воспринимал их в определённом порядке важности.

### Инструменты создания иерархии

| Инструмент | Как работает |
|------------|--------------|
| **Размер** | Крупные элементы привлекают внимание первыми |
| **Цвет и контраст** | Яркие цвета выделяются на фоне приглушённых |
| **Позиция** | Верх и лево воспринимаются первыми |
| **Пустое пространство** | Элемент с whitespace кажется важнее |
| **Типографика** | Жирность, курсив, размер создают иерархию текста |

---

## Паттерны сканирования

### F-паттерн

Характерен для страниц с большим количеством текста.

1. Горизонтальное чтение верхней части
2. Ещё одна горизонтальная линия (короче)
3. Вертикальное сканирование левой стороны

**Рекомендации:**
- Важная информация в начале абзацев
- Подзаголовки вдоль левого края
- Первые два абзаца — самые важные

### Z-паттерн

Характерен для лендингов с минимальным текстом.

Взгляд движется: левый верх → правый верх → диагональ вниз → правый низ

**Рекомендации:**
- Логотип в левом верхнем углу
- Навигация в правом верхнем
- CTA в конце Z-траектории

---

## Ключевые выводы

1. **UI ≠ UX**, но UI критически влияет на UX
2. **Гештальт-принципы** объясняют, как пользователи воспринимают интерфейс
3. **Визуальная иерархия** направляет внимание пользователя
4. **Паттерны сканирования** помогают размещать важную информацию правильно

---

## Задание

Сопоставьте гештальт-принципы с примерами их применения в интерфейсах.`
}

function getModule2Content(): string {
  return `# Типографика и работа с текстом

## Роль типографики в UI Design

Типографика — искусство и техника оформления текста. В цифровых интерфейсах текст составляет **до 95% контента**, поэтому типографика — один из важнейших инструментов UI-дизайнера.

### Что даёт хорошая типографика

- Читаемость контента
- Передача характера бренда
- Создание настроения
- Направление внимания пользователя

---

## Анатомия шрифта

### Основные элементы

| Элемент | Описание |
|---------|----------|
| **Baseline** | Линия, на которой "стоят" буквы |
| **X-height** | Высота строчной буквы "x" |
| **Cap height** | Высота заглавных букв |
| **Ascenders** | Части букв выше x-height (b, d, h) |
| **Descenders** | Части букв ниже baseline (g, p, y) |
| **Serifs** | Засечки на концах штрихов |

### Метрики и характеристики

- **Кегль** — размер шрифта (px для экрана)
- **Начертание (weight)** — толщина: Light, Regular, Medium, Bold, Black
- **Трекинг (tracking)** — расстояние между ВСЕМИ буквами
- **Кернинг (kerning)** — расстояние между КОНКРЕТНЫМИ парами букв
- **Интерлиньяж (line-height)** — расстояние между строками

---

## Классификация шрифтов

### Serif (с засечками)

Классические шрифты. Ассоциируются с надёжностью, традициями, академичностью.

**Примеры:** Times New Roman, Georgia, Playfair Display, Merriweather

**Когда использовать:** Длинные тексты в печати, заголовки, "премиальные" проекты

### Sans-serif (без засечек)

Современные шрифты. Ассоциируются с чистотой, технологичностью.

**Примеры:** Helvetica, Arial, Roboto, Inter, Open Sans, SF Pro

**Когда использовать:** Веб-интерфейсы, мобильные приложения, tech-продукты

### Monospace (моноширинные)

Каждый символ одинаковой ширины. Для кода и табличных данных.

**Примеры:** Courier, Consolas, JetBrains Mono, Fira Code

### Акцидентные (декоративные)

Яркий характер, только для заголовков. Никогда для основного текста.

---

## Модульная шкала размеров

Система размеров на математической прогрессии создаёт визуальную гармонию.

### Популярные коэффициенты

| Название | Коэффициент | Характер |
|----------|-------------|----------|
| Minor Second | 1.067 | Минимальный контраст |
| Major Second | 1.125 | Умеренный |
| **Minor Third** | **1.200** | Популярный выбор |
| Major Third | 1.250 | Выраженный |
| **Perfect Fourth** | **1.333** | Сильный контраст |
| Golden Ratio | 1.618 | Драматический |

### Пример шкалы Minor Third (1.200)

База: 16px

\`\`\`
16px (body)
16 × 1.2 = 19px
19 × 1.2 = 23px
23 × 1.2 = 28px
28 × 1.2 = 33px
33 × 1.2 = 40px
\`\`\`

Готовая иерархия: 16, 19, 23, 28, 33, 40px

---

## Интерлиньяж и длина строки

### Интерлиньяж (line-height)

| Контекст | Рекомендация |
|----------|--------------|
| Заголовки | 1.1 – 1.3 |
| Основной текст | 1.5 – 1.6 |
| Мелкий текст | 1.3 – 1.4 |

### Длина строки (measure)

**Оптимум: 45–75 символов** (идеально ~66)

Для 16px шрифта:
- Минимум: ~280px (45 символов)
- Оптимум: ~580px (66 символов)
- Максимум: ~700px (75 символов)

---

## Комбинирование шрифтов

### Правила

1. **Максимум 2-3 шрифта** в проекте
2. **Контраст работает лучше:** serif + sans-serif
3. Шрифты из одной стилистической категории
4. Проверьте наличие нужных начертаний (weights)

### Проверенные комбинации

- Playfair Display + Source Sans Pro
- Montserrat + Merriweather
- Roboto Slab + Roboto
- Inter + JetBrains Mono

> **Совет:** В 90% проектов достаточно одного хорошего шрифта с несколькими начертаниями (Inter, Roboto, SF Pro).

---

## Ключевые выводы

1. **Типографика = 95% контента.** Это критически важно.
2. **Трекинг ≠ Кернинг.** Трекинг — все буквы, кернинг — пары.
3. **Модульная шкала** создаёт гармонию размеров.
4. **45-75 символов** — оптимальная длина строки.
5. **2-3 шрифта максимум.** Больше — хаос.

---

## Задание

Найдите все ошибки в документации джуниор-дизайнера по типографике.`
}

function getModule3Content(): string {
  return `# Цвет и цветовые системы

## Теория цвета для цифровых интерфейсов

Цвет — один из самых мощных инструментов UI-дизайнера. Он влияет на восприятие бренда, создаёт визуальную иерархию, обозначает состояния элементов и вызывает эмоции.

---

## Цветовые модели

### RGB (Red, Green, Blue)

Аддитивная модель для экранов. Цвета создаются смешением света.

- Значения: 0–255 для каждого канала
- Чёрный: (0, 0, 0)
- Белый: (255, 255, 255)

### HEX

Шестнадцатеричное представление RGB: \`#RRGGBB\`

Пример: \`#FF5733\` = RGB(255, 87, 51)

### HSL (Hue, Saturation, Lightness)

Более интуитивная модель для дизайнеров:

| Параметр | Значение | Описание |
|----------|----------|----------|
| **Hue** | 0–360° | Оттенок на цветовом круге |
| **Saturation** | 0–100% | От серого до чистого цвета |
| **Lightness** | 0–100% | От чёрного до белого |

---

## Цветовые гармонии

### Монохроматическая

Один оттенок с разной насыщенностью и светлотой.

**Эффект:** Спокойствие, баланс. Идеально для минимализма.

### Аналоговая

Соседние оттенки на цветовом круге (синий, сине-зелёный, зелёный).

**Эффект:** Мягкость, гармония. Для природных тем.

### Комплементарная

Противоположные цвета на круге (синий и оранжевый).

**Эффект:** Сильный контраст. Использовать осторожно, для акцентов.

### Сплит-комплементарная

Вместо противоположного — два соседних с ним.

**Эффект:** Контраст мягче, чем комплементарная.

### Триада

Три равноудалённых цвета (красный, жёлтый, синий).

**Эффект:** Яркость, живость. Один доминирует, остальные — акценты.

---

## Структура цветовой палитры

### Primary Color

Главный цвет бренда. Для основных кнопок, активных состояний, главных акцентов.

### Secondary Color

Дополнительный акцентный цвет. Для второстепенных элементов.

### Neutral Colors

Оттенки серого (8-12 ступеней). Для текста, фонов, границ.

### Semantic Colors

| Цвет | Назначение |
|------|------------|
| **Success** (зелёный) | Успешные действия |
| **Warning** (жёлтый) | Предупреждения |
| **Error** (красный) | Ошибки |
| **Info** (синий) | Информация |

### Пример шкалы оттенков

\`\`\`
50:  #EFF6FF  (очень светлый, для фонов)
100: #DBEAFE
200: #BFDBFE
300: #93C5FD
400: #60A5FA
500: #3B82F6  (базовый)
600: #2563EB
700: #1D4ED8
800: #1E40AF
900: #1E3A8A  (очень тёмный)
\`\`\`

---

## Контраст и доступность (WCAG)

### Минимальные требования

| Уровень | Обычный текст | Крупный текст |
|---------|---------------|---------------|
| **AA** | 4.5:1 | 3:1 |
| **AAA** | 7:1 | 4.5:1 |

UI-компоненты и графика: минимум **3:1**

### Рекомендации

- Проверяйте контраст инструментами (WebAIM, Stark)
- Не полагайтесь только на цвет — дублируйте иконками, текстом
- Учитывайте дальтонизм
- Тестируйте в режиме симуляции цветовой слепоты

---

## Тёмная тема

### Принципы

1. **НЕ инвертируйте механически** — результат будет плохим
2. **Тёмно-серый, не чёрный** — \`#121212\` вместо \`#000000\`
3. **Elevation наоборот** — чем выше элемент, тем светлее фон
4. **Уменьшите насыщенность** ярких цветов
5. **Проверяйте контраст** — требования WCAG те же

### Рекомендуемые значения

| Элемент | Цвет |
|---------|------|
| Фон основной | #121212 – #1E1E1E |
| Фон приподнятый | #1E1E1E – #2D2D2D |
| Фон карточек | #2D2D2D – #383838 |
| Текст основной | rgba(255,255,255,0.87) |
| Текст вторичный | rgba(255,255,255,0.60) |
| Текст отключённый | rgba(255,255,255,0.38) |

---

## Дизайн-токены

> **Важно:** Создавайте семантические переменные, а не захардкоженные значения.

\`\`\`
// Плохо
color: #3B82F6;

// Хорошо
color: var(--color-primary-500);
color: var(--color-text-secondary);
\`\`\`

Это упрощает поддержку тёмной темы и ребрендинг.

---

## Ключевые выводы

1. **HSL интуитивнее RGB** для дизайнеров
2. **WCAG AA = 4.5:1** для обычного текста
3. **В тёмной теме** — elevation работает наоборот
4. **Дизайн-токены** — обязательно для масштабируемых систем
5. **Warning = жёлтый**, Error = красный, Success = зелёный

---

## Проверьте себя

Этот модуль теоретический. Примените знания в практических заданиях других модулей.`
}

function getModule4Content(): string {
  return `# Сетки и композиция

## Роль сетки в UI Design

Сетка (grid) — система направляющих линий и колонок для организации элементов интерфейса. Она обеспечивает:

- Консистентность между экранами
- Упрощение командной работы
- Ускорение процесса дизайна

> В отличие от печатного дизайна, веб-сетки должны быть **гибкими** и адаптироваться к разным экранам.

---

## Анатомия сетки

| Элемент | Описание | Типичные значения |
|---------|----------|-------------------|
| **Columns** | Вертикальные секции | 12 (desktop), 8 (tablet), 4 (mobile) |
| **Gutters** | Пространство между колонками | 16px, 20px, 24px |
| **Margins** | Отступы по краям экрана | 16-24px (mobile), 32px+ (desktop) |
| **Module** | Базовая единица измерения | 4px или 8px |

---

## Типы сеток

### Колоночная сетка (Column Grid)

Самый распространённый тип. 12 колонок стали стандартом благодаря Bootstrap и высокой делимости (1, 2, 3, 4, 6, 12).

### Модульная сетка (Modular Grid)

Добавляет горизонтальные деления. Для галерей, карточек одинакового размера.

### Иерархическая сетка (Hierarchical Grid)

Нестандартная, под конкретный контент. Колонки разной ширины.

### Baseline Grid

Горизонтальная сетка, привязанная к интерлиньяжу. Шаг = базовый line-height (например, 24px).

---

## Система отступов 8px

### Почему 8px?

- Делится на 2 и 4 (можно использовать 4px для мелких деталей)
- Большинство разрешений экранов кратны 8
- Достаточно крупный шаг для заметного различия
- Достаточно мелкий для точной настройки

### Шкала отступов

\`\`\`
4px   — минимальный, для плотных элементов
8px   — базовый, внутри компонентов
16px  — стандартный между элементами
24px  — между группами элементов
32px  — между секциями
48px  — крупный, смысловые блоки
64px, 80px, 96px — hero-секции
\`\`\`

---

## Breakpoints и адаптивность

### Стандартные breakpoints

| Устройство | Ширина | Колонки | Margins | Gutters |
|------------|--------|---------|---------|---------|
| Mobile | 320–767px | 4 | 16px | 16px |
| Tablet | 768–1023px | 8 | 24px | 20px |
| Desktop | 1024–1439px | 12 | 32px | 24px |
| Large Desktop | 1440px+ | 12 | auto | 24px |

### Стратегии адаптации

- **Reflow** — элементы меняют расположение (3 → 2 → 1 карточки)
- **Resize** — элементы масштабируются пропорционально
- **Reveal/Hide** — элементы появляются или скрываются
- **Reposition** — элементы меняют позицию (sidebar → бургер-меню)

---

## Правила композиции

### Правило третей

Делим пространство на 9 частей. Важные элементы на линиях или пересечениях ("точках силы").

### Золотое сечение

Пропорция ~1:1.618. Для соотношения колонок (sidebar 38%, main 62%), отступов, размеров.

### Визуальный баланс

| Тип | Описание | Эффект |
|-----|----------|--------|
| Симметричный | Зеркальное расположение | Стабильность, формальность |
| Асимметричный | Разные элементы уравновешивают | Динамика, современность |
| Радиальный | Вокруг центральной точки | Специфические интерфейсы |

---

## Порядок настройки сетки

1. Выбрать базовый модуль (4px или 8px)
2. Создать шкалу отступов
3. Установить breakpoints
4. Определить количество колонок для каждого breakpoint
5. Настроить gutters и margins
6. Определить стратегии адаптации
7. Протестировать на реальном контенте
8. Задокументировать для команды

---

> **Помните:** Сетка — инструмент, не тюрьма. Осознанное нарушение сетки создаёт акцент. Но сначала освойте правила.

---

## Ключевые выводы

1. **12 колонок** — стандарт для desktop
2. **8px система** — баланс гибкости и простоты
3. **Mobile-first** — начинайте с 4 колонок
4. **Стратегии адаптации** — reflow, resize, reveal/hide, reposition
5. **Документируйте** сетку для команды

---

## Задание

Расставьте этапы настройки сеточной системы в правильном порядке.`
}

function getModule5Content(): string {
  return `# Компоненты и UI Kit

## Понятие компонента

Компонент — переиспользуемый элемент интерфейса с определённым поведением и внешним видом. Компонентный подход обеспечивает:

- **Консистентность** — одинаковые элементы везде
- **Эффективность** — изменение в одном месте обновляет всё
- **Масштабируемость** — легко расширять систему
- **Командная работа** — единый язык для дизайнеров и разработчиков

---

## Atomic Design

Методология Brad Frost для организации компонентов.

### Уровни

| Уровень | Описание | Примеры |
|---------|----------|---------|
| **Атомы** | Базовые, неделимые элементы | Кнопка, input, иконка, лейбл |
| **Молекулы** | Группы атомов | Поле поиска (input + button + icon) |
| **Организмы** | Сложные компоненты из молекул | Шапка сайта, форма регистрации |
| **Шаблоны** | Структура страницы без контента | Макет лендинга |
| **Страницы** | Шаблоны с реальным контентом | Готовая страница |

---

## Состояния компонентов

Каждый интерактивный компонент существует в нескольких состояниях. **Дизайнер должен продумать каждое.**

### Основные состояния

| Состояние | Описание | Визуальный индикатор |
|-----------|----------|---------------------|
| **Default** | Стандартный вид | Базовый стиль |
| **Hover** | При наведении курсора | Изменение яркости, лёгкая тень |
| **Pressed** | В момент нажатия | Уменьшение яркости, inset shadow |
| **Focused** | Выбран с клавиатуры | Чёткий outline |
| **Disabled** | Недоступен | Opacity 50-60%, cursor: not-allowed |
| **Loading** | В процессе | Spinner, блокировка кликов |
| **Error** | Ошибка | Красная граница, иконка |
| **Success** | Успех | Зелёная индикация |

> **Важно:** Никогда не убирайте focus outline — это критично для доступности!

---

## Основные UI-компоненты

### Кнопки (Buttons)

| Тип | Использование | Стиль |
|-----|---------------|-------|
| **Primary** | Главное действие | Яркий, заполненный |
| **Secondary** | Альтернатива | Outlined или приглушённый |
| **Tertiary** | Наименее важное | Только текст |
| **Destructive** | Опасное действие | Красный |

**Размеры:** Small (28-32px), Medium (36-40px), Large (44-48px)

> Touch target для мобильных — минимум **44×44px**

### Формы и поля ввода

- Text Input — однострочный
- Textarea — многострочный
- Select/Dropdown — выбор из списка
- Checkbox — множественный выбор
- Radio — единственный выбор
- Toggle/Switch — вкл/выкл
- Date Picker — выбор даты
- Slider — значение из диапазона

### Навигация

- Navigation Bar — основная навигация
- Tabs — переключение секций
- Breadcrumbs — местоположение в иерархии
- Pagination — навигация по страницам
- Bottom Navigation — для мобильных

### Обратная связь

- **Toast/Snackbar** — короткое уведомление, исчезает автоматически
- **Alert/Banner** — важное сообщение, требует внимания
- **Modal/Dialog** — окно поверх контента
- **Tooltip** — подсказка при наведении
- **Progress Bar** — индикатор прогресса
- **Skeleton** — placeholder загружающегося контента

---

## Организация UI Kit

### Структура

\`\`\`
Foundation/
  ├── Colors
  ├── Typography
  ├── Icons
  ├── Spacing
  ├── Shadows
  └── Border Radius

Components/
  ├── Buttons
  ├── Inputs
  ├── Navigation
  ├── Cards
  ├── Feedback
  └── ...

Patterns/
  ├── Login Form
  ├── Product Card
  └── ...

Templates/
  └── Page Layouts
\`\`\`

### Документирование компонентов

Каждый компонент должен иметь:

- Название и описание назначения
- Все варианты (variants) и размеры
- Все состояния
- Примеры использования
- Do's and Don'ts
- Особенности доступности

---

## Инструменты

> **Совет:** Используйте **Auto Layout в Figma** для создания компонентов, которые автоматически адаптируются к контенту.

---

## Ключевые выводы

1. **Atomic Design** — атомы → молекулы → организмы → шаблоны → страницы
2. **Все состояния обязательны** — default, hover, pressed, focused, disabled, loading, error
3. **Focus outline не удаляйте** — это для доступности
4. **Touch target ≥ 44px** на мобильных
5. **Документируйте** каждый компонент

---

## Задание

Сопоставьте состояния компонентов с их визуальными индикаторами.`
}

function getModule6Content(): string {
  return `# Прототипирование и анимация

## Уровни детализации прототипов

Прототип — интерактивная модель продукта для тестирования идей до разработки.

### Lo-fi (Low-fidelity)

Схематичные, минималистичные. Обычно чёрно-белые.

**Когда:** Ранние этапы, исследование UX, быстрое тестирование идей

**Плюсы:** Быстрота, фокус на функциональности, легко менять

### Mid-fi (Mid-fidelity)

Детализированные вайрфреймы с базовой типографикой и реальным текстом.

**Когда:** После валидации концепции, согласование с заказчиком, юзабилити-тестирование

### Hi-fi (High-fidelity)

Максимально близко к финальному продукту. Полный дизайн, анимации, микровзаимодействия.

**Когда:** Финальное тестирование, презентации, handoff разработчикам

---

## Интерактивность в прототипах

### Типы переходов

| Переход | Описание |
|---------|----------|
| **Instant** | Мгновенный, без анимации |
| **Dissolve** | Плавное появление (fade) |
| **Smart Animate** | Автоматическая анимация между состояниями (Figma) |
| **Slide** | Скольжение в направлении |
| **Push** | Новый экран выталкивает предыдущий |
| **Move In/Out** | Наезд/отъезд |

### Триггеры взаимодействий

- On Click/Tap
- On Hover
- On Drag
- While Pressing
- Key/Gamepad
- Mouse Enter/Leave
- After Delay

---

## Принципы анимации в UI

Анимация — не украшение. Она даёт обратную связь, направляет внимание, объясняет пространственные отношения, создаёт ощущение качества.

### Адаптированные принципы Disney

| Принцип | Применение в UI |
|---------|-----------------|
| **Easing** | Объекты не начинают/заканчивают движение мгновенно |
| **Anticipation** | Небольшое подготовительное движение |
| **Staging** | Анимация направляет внимание на важное |
| **Secondary Action** | Дополнительные движения (ripple-эффект) |
| **Timing** | Скорость влияет на восприятие |
| **Exaggeration** | Небольшое преувеличение делает анимацию выразительной |

---

## Тайминг и кривые анимации

### Рекомендуемые длительности

| Тип | Длительность |
|-----|--------------|
| Микровзаимодействия (hover, focus) | 100–200ms |
| Небольшие переходы (dropdown) | 200–300ms |
| Средние переходы (модальные окна) | 300–400ms |
| Крупные переходы (смена экрана) | 400–500ms |
| Сложные анимации | до 700ms |

### Кривые анимации (Easing)

| Кривая | Описание | Когда использовать |
|--------|----------|-------------------|
| **Linear** | Постоянная скорость | Редко, выглядит механически |
| **Ease-in** | Медленное начало | Элементы, покидающие экран |
| **Ease-out** | Медленный конец | Элементы, появляющиеся на экране |
| **Ease-in-out** | Медленное начало и конец | Универсальный выбор |
| **Spring** | Имитация пружины | Ощущение "живости" |

---

## Микровзаимодействия

Маленькие, целевые взаимодействия для одной задачи.

### Структура

1. **Trigger** — что инициирует (клик, наведение, свайп)
2. **Rules** — что происходит в ответ
3. **Feedback** — как пользователь узнаёт о результате
4. **Loops & Modes** — повторение и изменение поведения

### Примеры

- Pull-to-refresh
- Like animation (сердечко)
- Form validation подсветка
- Password strength индикатор
- Loading states (скелетоны, спиннеры)
- Swipe actions (удалить, архивировать)

---

## Лучшие практики

### Производительность

- Анимируйте только **transform** и **opacity** — они не вызывают reflow
- Избегайте width, height, top, left — они тяжёлые
- Используйте will-change для подсказки браузеру
- Тестируйте на слабых устройствах

### Доступность

- Учитывайте **prefers-reduced-motion**
- Не мигайте чаще 3 раз в секунду (риск эпилепсии)
- Анимация не должна блокировать взаимодействие
- Обеспечьте альтернативный способ получить информацию

---

> **Золотое правило:** Анимация должна быть незаметной в хорошем смысле. Пользователь не должен думать об анимации — она просто делает интерфейс приятнее. Если анимация привлекает к себе внимание — она слишком длинная или интенсивная.

---

## Порядок работы над прототипом

1. Определить user flows
2. Создать lo-fi скетчи
3. Быстрое тестирование lo-fi
4. Доработать до mid-fi с реальным текстом
5. Применить hi-fi дизайн
6. Добавить микровзаимодействия и анимации
7. Финальное юзабилити-тестирование
8. Передать разработчикам с документацией

---

## Ключевые выводы

1. **Lo-fi → Mid-fi → Hi-fi** — последовательное увеличение детализации
2. **Ease-in-out** — универсальный выбор для большинства анимаций
3. **100-500ms** — диапазон для большинства UI-анимаций
4. **transform + opacity** — единственные "дешёвые" свойства для анимации
5. **prefers-reduced-motion** — уважайте настройки пользователей

---

## Задание

Расставьте этапы работы над прототипом в правильном порядке.`
}
